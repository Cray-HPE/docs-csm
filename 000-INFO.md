# CRAY Guide Contribution

Contributing is encouraged, anyone can make a pull-request.

All this guide asks is for a few guard-rails to keep things organized ...

# Page Indexing / Naming

The page name can be anything. This repo has a loose pattern to assist tab-completion and contextual
heuristics:

    [XYZ]-[context]-[memo].md

Examples:
    - `010-UAN-DEPLOY.md`
    - `040-CN-DISCOVERY.md`
    - `333-LIVCD-RECOVERY-GUIDE.md`

# Annotations

This repository may change annotations, for now under the MarkDown governance these are the available annotions.

**You must use these to denote the right steps to the right audience.**

These are context clues for steps, if they contain these and you are not in that context you ought to skip them.

> **`AIRGAP/OFFLINE USE`**

This tag should preface any block that is for offline install steps or procedures, where there is 
no online/internet connection.

> **`EXTERNAL USE`** 

This tag should be used to highlight anything that an internal user should ignore or skip.

> **`INTERNAL USE`** 

This tag should be before any block of instruction or text that is only usable or recommended for 
internal CRAY labs.

External (GitHub or customer) should disregard these annotated blocks - they maybe contain useful
information but are not intended for their use.
 

> **`PREFERRED`** use the generated files from your system inputs...
> **`MANUAL`** without CPT files generated by CSI...

These tags denote forks in a direction, denoting a fallback or manual method of the faster/preferred 
method is not doable in the given context.

# Command Prompt Conventions

## Host name and account in command prompts

The host name in a command prompt indicates where the command must be run.  The account that must run the command is also indicated in the prompt.
- The root or super-user account always has the # character at the end of the prompt
- Any non-root account is indicated with account@hostname>.  A non-privileged account is referred to as user.

## Node abbreviations
The following list conatins abbrev iations for nodes used below

* CN - compute Node
* NCN - Non Compute Node
* AN - Application Node (special type of NCN)
* UAN - User Access Node (special type of AN)
* PIT - Pre-Install Toolkit (initial node used as the inception node during software installation booted from the LiveCD)

| Prompt | Description |
| ------ | ----------- |
| ncn# | Run the command as root on any NCN, except an NCN which is functioning as an Application Node (AN), such as a UAN. |
| ncn-m# | Run the command as root on any NCN-M (NCN which is a Kubernetes master node).|
| ncn-m002# | Run the command as root on the specific NCN-M (NCN which is a Kubernetes master node) which has this hostname (ncn-m002). |
| ncn-w# | Run the command as root on any NCN-W (NCN which is a Kubernetes worker node).|
| ncn-w001# | Run the command as root on the specific NCN-W (NCN which is a Kubernetes master node) which has this hostname (ncn-w001). |
| ncn-s# | Run the command as root on any NCN-S (NCN which is a Utility Storage node).|
| ncn-s003# | Run the command as root on the specific NCN-S (NCN which is a Utility Storage node) which has this hostname (ncn-s003). |
| pit# | Run the command as root on the PIT node. |
| linux# | Run the command as root on a linux host. |
| uan# | Run the command as root on any UAN. |
| uan01# | Run the command as root on any UAN. |
| user@uan> | Run the command as any non-root user on any UAN. |
| cn# | Run the command as root on any CN.  Note that a CN will have a hostname of the form nid124356, that is "nid" and a six digit, zero padded number. |
| hostname# | Run the command as root on the specified hostname. |
| user@hostname> | Run the command as any non-root user son the specified hostname. |

## Command prompt inside chroot

If the chroot command is used, the prompt changes to indicate
that it is inside a chroot environment on the system.

```bash
hostname# chroot /path/to/chroot
chroot-hostname#

```

## Command prompt inside Kubernetes pod

If executing a shell inside a container of a Kubernetes pod where
the pod name is $podName, the prompt changes to indicate that it
is inside the pod. Not all shells are available within every pod, this
is an example using a commonly available shell.

```bash
ncn# kubectl exec -it $podName /bin/sh
pod#
```

## Command prompt inside image customization session

If using ssh during an image customization session, the prompt
changes to indicate that it is inside the image customization
environment (pod). This example uses $PORT and $HOST as
environment variables with specific settings. When using chroot in
this context the prompt will be different than the above chroot
example.

```bash
hostname# ssh -p $PORT root@$HOST
root@POD# chroot /mnt/image/image-root
:/#
```

## Directory path in command prompt

Example prompts do not include the directory path, because long
paths can reduce the clarity of examples. Most of the time, the
command can be executed from any directory. When it matters
which directory the command is invoked within, the cd command
is used to change into the directory, and the directory is referenced
with a period (.) to indicate the current directory

Examples of prompts as they appear on the system:

```bash
hostname:~ # cd /etc
hostname:/etc# cd /var/tmp
hostname:/var/tmp# ls ./file
hostname:/var/tmp# su - user
user@hostname:~> cd /usr/bin
user hostname:/usr/bin> ./command
```

Examples of prompts as they appear in this publication:

```bash
hostname # cd /etc
hostname # cd /var/tmp
hostname # ls ./file
hostname # su - user
user@hostname > cd /usr/bin
user@hostname > ./command
```

[1]: https://cray.slack.com/messages/docs-csm-install
