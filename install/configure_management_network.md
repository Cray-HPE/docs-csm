# Configure Management Network

HPE Cray EX systems can have network switches in many roles: spine switches, leaf switches, leaf-bmc switches, and CDU switches.
Newer systems have HPE Aruba switches, while older systems have Dell and Mellanox switches. Switch IP addresses are generated by Cray Site Init (CSI).


Documentation for the Management can be found here [Management Net Docs](../operations/network/index.md)


The configuration for these switches will be generated from CSM Automated Network Utility (CANU)
Documentation for CANU can be found at https://github.com/Cray-HPE/canu

It is assumed that the administrator configuring the Management Network has a basic understanding of networking protocols (STP, VLAN, OSPF, LAG/MLAG, BGP, etc...), and knows how to configure network equipment. It is also assumed that they understand and know how to read an SHCD file.

Before configuring/reconfiguring any switches, make sure to get the current running configuration and save that in case the configuration must be reverted.

All switch configuration should be done with a console or out of band connection.

Save the output of the following:

```bash
# show run
```

   * [Next Topic](#next-topic)


## Details

<a name="hpe_aruba_switch_configuration"></a>
### HPE Aruba Switch Configuration

The management network switches should be configured in this order: Spine, Aggregation (if present), CDU (if present), and Leaf.
Only systems with liquid-cooled cabinets will have the CDU switches. Only systems with many nodes in air-cooled cabinets
will have Aggregation switches.


<a name="dell_and_mellanox_switch_configuration"></a>
### Dell and Mellanox Switch Configuration

The management network switches should be configured in this order: Spine, Aggregation (if present), CDU (if present), and Leaf.
Only systems with liquid-cooled cabinets will have the CDU switches. Only systems with many nodes in air-cooled
cabinets will have Aggregation switches.

On a typical system, the Mellanox switches are Spine switches and the Dell switches are used for Aggregation, CDU, and Leaf switches.

## Site connections

Currently CANU ***does not*** automatically create site connections (LAGs/uplink interfaces or default routes). 

Hence you need to manually configure the uplinks for site connections as well as default routes. 

Example configuration: 

NOTE: these are very simplistic examples and depending on your install scenario you may need to also configure LAG's etc. 

***Mellanox***

```
sw-spine-001 [standalone: master] > ena
sw-spine-001 [standalone: master] # conf t
sw-spine-001 [standalone: master] (config) #interface ethernet 1/16 no switchport force
sw-spine-001 [standalone: master] (config) #interface ethernet 1/16 speed 10G force
sw-spine-001 [standalone: master] (config) #interface ethernet 1/16 ip address 10.102.255.10/30 primary
sw-spine-001 [standalone: master] (config) #ip route vrf Customer 0.0.0.0/0 10.102.3.3 
sw-spine-001 [standalone: master] (config) #ip route vrf Customer 0.0.0.0/0 10.102.255.9
```
***Aruba***

```
sw-spine-001# config
sw-spine-001(config)# Interface 1/1/16
sw-spine-001(int-1/1/16)# vrf attach Customer
sw-spine-001(int-1/1/16)# ip address 10.102.255.10/30
sw-spine-001(int-1/1/16)# no shutdown
sw-spine-001(int-1/1/16)# exit
sw-spine-001(int-1/1/16)# ip route 0.0.0.0/0 10.102.3.3 vrf Customer
sw-spine-001(int-1/1/16)# ip route 0.0.0.0/0 0.102.255.9 vrf Customer
```


<a name="next-topic"></a>
# Next Topic

   After completing this procedure, collect MAC Addresses for the management nodes using the PIT node and the management network switches configured in this procedure.

   * See [Collect Mac Addresses](index.md#collect_mac_addresses_for_ncns)
