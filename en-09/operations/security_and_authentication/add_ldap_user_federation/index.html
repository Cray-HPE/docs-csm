<!DOCTYPE html>
<html lang="en-09" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.123.0">
    <meta name="description" content="">


    <link rel="icon" href="/docs-csm/images/favicon.png" type="image/png">

    <title>Add LDAP User Federation :: Cray System Management (CSM)</title>

    
    <link href="/docs-csm/css/nucleus.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/fontawesome-all.min.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/hybrid.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/featherlight.min.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/perfect-scrollbar.min.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/auto-complete.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/atom-one-dark-reasonable.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/theme.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/tabs.css?1729741358" rel="stylesheet">
    <link href="/docs-csm/css/hugo-theme.css?1729741358" rel="stylesheet">
    
    <link href="/docs-csm/css/theme-blue.css?1729741358" rel="stylesheet">
    
    

    <script src="/docs-csm/js/jquery-3.3.1.min.js?1729741358"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/docs-csm/en-09/operations/security_and_authentication/add_ldap_user_federation/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href='/docs-csm/en-09'>
  Cray System Management
</a>

    </div>

    
    <section>
      <ul>
      
        <li>
          <div class="select-style padding">
          v <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en-16" value="/docs-csm/en-16/operations/security_and_authentication/add_ldap_user_federation/">1.6</option>
                    
                  
              
                  
              
                  
              
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="en-15" value="/docs-csm/en-15/operations/security_and_authentication/add_ldap_user_federation/">1.5</option>
                    
                  
              
                  
              
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-14" value="/docs-csm/en-14/operations/security_and_authentication/add_ldap_user_federation/">1.4</option>
                    
                  
              
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-13" value="/docs-csm/en-13/operations/security_and_authentication/add_ldap_user_federation/">1.3</option>
                    
                  
              
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-12" value="/docs-csm/en-12/operations/security_and_authentication/add_ldap_user_federation/">1.2</option>
                    
                  
              
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-10" value="/docs-csm/en-10/operations/security_and_authentication/add_ldap_user_federation/">1.0</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
              
                  
              
                  
              
                  
              
                  
              
                  
                    
                    
                      <option id="en-09" value="/docs-csm/en-09/operations/security_and_authentication/add_ldap_user_federation/" selected>0.9</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </li>
      

      
      </ul>
    </section>
  

    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/docs-csm/js/lunr.min.js?1729741358"></script>
<script type="text/javascript" src="/docs-csm/js/auto-complete.js?1729741358"></script>
<script type="text/javascript">
    
        var baseurl = "\/docs-csm\/\/en-09";
    
</script>
<script type="text/javascript" src="/docs-csm/js/search.js?1729741358"></script>

    
  </div>

  

    <div class="highlightable">
    <ul class="topics">
      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/421-mgmt-net-cabling-checklist/" title="1.4 Management network cabling checklist" class="dd-item ">
        <a href="/docs-csm/en-09/421-mgmt-net-cabling-checklist/">
        1.4 Management network cabling checklist
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/308-application-node-config/" title="Application Node Config" class="dd-item ">
        <a href="/docs-csm/en-09/308-application-node-config/">
        Application Node Config
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/310-cabinets/" title="Cabinets" class="dd-item ">
        <a href="/docs-csm/en-09/310-cabinets/">
        Cabinets
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/416-mgmt-net-cabling/" title="Cabling" class="dd-item ">
        <a href="/docs-csm/en-09/416-mgmt-net-cabling/">
        Cabling
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/066-ceph-csi/" title="CEPH CSI Verification" class="dd-item ">
        <a href="/docs-csm/en-09/066-ceph-csi/">
        CEPH CSI Verification
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/302-ncn-metadata-bondx/" title="Collecting NCN MAC Addresses" class="dd-item ">
        <a href="/docs-csm/en-09/302-ncn-metadata-bondx/">
        Collecting NCN MAC Addresses
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/301-ncn-metadata-bmc/" title="Collecting the BMC MAC Addresses" class="dd-item ">
        <a href="/docs-csm/en-09/301-ncn-metadata-bmc/">
        Collecting the BMC MAC Addresses
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/257-firmware-action-service-cray-windom-compute-node-bios-workaround/" title="Compute Node BIOS workaround for WNC-rome aka HPE CRAY EX425" class="dd-item ">
        <a href="/docs-csm/en-09/257-firmware-action-service-cray-windom-compute-node-bios-workaround/">
        Compute Node BIOS workaround for WNC-rome aka HPE CRAY EX425
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/000-info/" title="CRAY Guide Contribution" class="dd-item ">
        <a href="/docs-csm/en-09/000-info/">
        CRAY Guide Contribution
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/063-csi-files/" title="Cray Site Init Files" class="dd-item ">
        <a href="/docs-csm/en-09/063-csi-files/">
        Cray Site Init Files
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/release_notes/" title="Cray System Management (CSM) - Release Notes" class="dd-item ">
        <a href="/docs-csm/en-09/release_notes/">
        Cray System Management (CSM) - Release Notes
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/001-guides/" title="CSM Documentation Guide" class="dd-item ">
        <a href="/docs-csm/en-09/001-guides/">
        CSM Documentation Guide
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/002-csm-install/" title="CSM Install" class="dd-item ">
        <a href="/docs-csm/en-09/002-csm-install/">
        CSM Install
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/007-csm-install-reboot/" title="CSM Install Reboot - Final NCN Install" class="dd-item ">
        <a href="/docs-csm/en-09/007-csm-install-reboot/">
        CSM Install Reboot - Final NCN Install
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/008-csm-validation/" title="CSM Install Validation and Health Checks" class="dd-item ">
        <a href="/docs-csm/en-09/008-csm-validation/">
        CSM Install Validation and Health Checks
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/005-csm-metal-install/" title="CSM Metal Install" class="dd-item ">
        <a href="/docs-csm/en-09/005-csm-metal-install/">
        CSM Metal Install
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/006-csm-platform-install/" title="CSM Platform Install" class="dd-item ">
        <a href="/docs-csm/en-09/006-csm-platform-install/">
        CSM Platform Install
        
        </a>
    </li>
     
  
 

      
      




 
  
    
    <li data-nav-id="/docs-csm/en-09/troubleshooting/" title="CSM Troubleshooting Information" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/troubleshooting/">
          CSM Troubleshooting Information
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/troubleshooting/known_issues/" title="known issues" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/troubleshooting/known_issues/">
          known issues
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/troubleshooting/known_issues/cfs_sessions_stuck_in_pending/" title="CFS Sessions are Stuck in Pending State" class="dd-item ">
        <a href="/docs-csm/en-09/troubleshooting/known_issues/cfs_sessions_stuck_in_pending/">
        CFS Sessions are Stuck in Pending State
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/troubleshooting/known_issues/conman_pod_kubernetes_copy_fails/" title="Copying file from the cray-conman pod fails" class="dd-item ">
        <a href="/docs-csm/en-09/troubleshooting/known_issues/conman_pod_kubernetes_copy_fails/">
        Copying file from the cray-conman pod fails
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/troubleshooting/known_issues/orphaned_cfs_pods/" title="Orphaned CFS Pods After Booting or Rebooting" class="dd-item ">
        <a href="/docs-csm/en-09/troubleshooting/known_issues/orphaned_cfs_pods/">
        Orphaned CFS Pods After Booting or Rebooting
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/003-csm-usb-livecd/" title="CSM USB LiveCD - Creation and Configuration" class="dd-item ">
        <a href="/docs-csm/en-09/003-csm-usb-livecd/">
        CSM USB LiveCD - Creation and Configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/051-disk-cleanslate/" title="Disk Cleanslate" class="dd-item ">
        <a href="/docs-csm/en-09/051-disk-cleanslate/">
        Disk Cleanslate
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/255-firmware-action-service-fas/" title="FIRMWARE ACTION SERVICE (FAS) | User Procedures" class="dd-item ">
        <a href="/docs-csm/en-09/255-firmware-action-service-fas/">
        FIRMWARE ACTION SERVICE (FAS) | User Procedures
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/256-firmware-action-service-fas-recipes/" title="Firmware Action Service (FAS) Administration Guide" class="dd-item ">
        <a href="/docs-csm/en-09/256-firmware-action-service-fas-recipes/">
        Firmware Action Service (FAS) Administration Guide
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/250-firmware/" title="Firmware Checkout" class="dd-item ">
        <a href="/docs-csm/en-09/250-firmware/">
        Firmware Checkout
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/010-firmware-update-with-fas/" title="Firmware Update the system with FAS" class="dd-item ">
        <a href="/docs-csm/en-09/010-firmware-update-with-fas/">
        Firmware Update the system with FAS
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/254-ncn-firmware-gb/" title="Gigabyte Firmware Bug" class="dd-item ">
        <a href="/docs-csm/en-09/254-ncn-firmware-gb/">
        Gigabyte Firmware Bug
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/304-ncn-pcie-net-boot-and-re-cable/" title="Guide  Netboot an NCN from a Spine" class="dd-item ">
        <a href="/docs-csm/en-09/304-ncn-pcie-net-boot-and-re-cable/">
        Guide  Netboot an NCN from a Spine
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/068-harvest-13-config/" title="HARVEST 13 CONFIG" class="dd-item ">
        <a href="/docs-csm/en-09/068-harvest-13-config/">
        HARVEST 13 CONFIG
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/307-hmn-connections/" title="HMN Connections File" class="dd-item ">
        <a href="/docs-csm/en-09/307-hmn-connections/">
        HMN Connections File
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/418-mgmt-net-ip-helper/" title="IP-Helper configuration" class="dd-item ">
        <a href="/docs-csm/en-09/418-mgmt-net-ip-helper/">
        IP-Helper configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/061-livecd-metal-basecamp/" title="LiveCD - Metal Basecamp" class="dd-item ">
        <a href="/docs-csm/en-09/061-livecd-metal-basecamp/">
        LiveCD - Metal Basecamp
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/060-livecd-1.3-rollback/" title="LiveCD 1.3 Rollback" class="dd-item ">
        <a href="/docs-csm/en-09/060-livecd-1.3-rollback/">
        LiveCD 1.3 Rollback
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/059-livecd-backup/" title="LiveCD Re-Installs" class="dd-item ">
        <a href="/docs-csm/en-09/059-livecd-backup/">
        LiveCD Re-Installs
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/058-livecd-troubleshooting/" title="LiveCD Recovery" class="dd-item ">
        <a href="/docs-csm/en-09/058-livecd-troubleshooting/">
        LiveCD Recovery
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/004-csm-remote-livecd/" title="LiveCD Remote ISO Install" class="dd-item ">
        <a href="/docs-csm/en-09/004-csm-remote-livecd/">
        LiveCD Remote ISO Install
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/062-livecd-virtual-iso-boot/" title="LiveCD Virtual ISO Boot" class="dd-item ">
        <a href="/docs-csm/en-09/062-livecd-virtual-iso-boot/">
        LiveCD Virtual ISO Boot
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/405-mgmt-net-port-config/" title="Management Network Access Port configurations." class="dd-item ">
        <a href="/docs-csm/en-09/405-mgmt-net-port-config/">
        Management Network Access Port configurations.
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/406-mgmt-net-acl-config/" title="Management Network ACL configuration" class="dd-item ">
        <a href="/docs-csm/en-09/406-mgmt-net-acl-config/">
        Management Network ACL configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/402-mgmt-net-base-config/" title="Management Network Base Configuration" class="dd-item ">
        <a href="/docs-csm/en-09/402-mgmt-net-base-config/">
        Management Network Base Configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/408-mgmt-net-can-config/" title="Management Network CAN setup" class="dd-item ">
        <a href="/docs-csm/en-09/408-mgmt-net-can-config/">
        Management Network CAN setup
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/412-mgmt-net-dell-mellanox-upgrades/" title="Management Network Dell And Mellanox Upgrades" class="dd-item ">
        <a href="/docs-csm/en-09/412-mgmt-net-dell-mellanox-upgrades/">
        Management Network Dell And Mellanox Upgrades
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/413-mgmt-net-example-config/" title="Management Network Example Config" class="dd-item ">
        <a href="/docs-csm/en-09/413-mgmt-net-example-config/">
        Management Network Example Config
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/409-mgmt-net-firmware-update/" title="Management Network Firmware Update" class="dd-item ">
        <a href="/docs-csm/en-09/409-mgmt-net-firmware-update/">
        Management Network Firmware Update
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/417-mgmt-net-flow-control/" title="Management Network Flow Control Settings" class="dd-item ">
        <a href="/docs-csm/en-09/417-mgmt-net-flow-control/">
        Management Network Flow Control Settings
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/411-mgmt-net-layer3-config/" title="Management Network Layer3 Configuration" class="dd-item ">
        <a href="/docs-csm/en-09/411-mgmt-net-layer3-config/">
        Management Network Layer3 Configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/404-mgmt-net-mlag-config/" title="Management Network MLAG Configuration" class="dd-item ">
        <a href="/docs-csm/en-09/404-mgmt-net-mlag-config/">
        Management Network MLAG Configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/414-mgmt-net-ntp-config/" title="Management Network NTP configuration" class="dd-item ">
        <a href="/docs-csm/en-09/414-mgmt-net-ntp-config/">
        Management Network NTP configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/407-mgmt-net-snmp-config/" title="Management Network SNMP configuration" class="dd-item ">
        <a href="/docs-csm/en-09/407-mgmt-net-snmp-config/">
        Management Network SNMP configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/419-mgmt-net-stp/" title="Management Network Spanning-Tree Configuration." class="dd-item ">
        <a href="/docs-csm/en-09/419-mgmt-net-stp/">
        Management Network Spanning-Tree Configuration.
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/415-mgmt-net-switch-rename/" title="Management Network Switch Rename" class="dd-item ">
        <a href="/docs-csm/en-09/415-mgmt-net-switch-rename/">
        Management Network Switch Rename
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/410-mgmt-net-uplink-config/" title="Management Network Uplink configuration" class="dd-item ">
        <a href="/docs-csm/en-09/410-mgmt-net-uplink-config/">
        Management Network Uplink configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/403-mgmt-net-vlan-config/" title="Management Network VLAN Configuration" class="dd-item ">
        <a href="/docs-csm/en-09/403-mgmt-net-vlan-config/">
        Management Network VLAN Configuration
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/306-sls-add-uan-alias/" title="Manually add UAN Aliases to SLS" class="dd-item ">
        <a href="/docs-csm/en-09/306-sls-add-uan-alias/">
        Manually add UAN Aliases to SLS
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/309-move-site-connections/" title="Move Site Connections" class="dd-item ">
        <a href="/docs-csm/en-09/309-move-site-connections/">
        Move Site Connections
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/200-ncn-bios-pref/" title="NCN BIOS Preferences" class="dd-item ">
        <a href="/docs-csm/en-09/200-ncn-bios-pref/">
        NCN BIOS Preferences
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/101-ncn-booting/" title="NCN Booting" class="dd-item ">
        <a href="/docs-csm/en-09/101-ncn-booting/">
        NCN Booting
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/107-ncn-devel/" title="NCN Development" class="dd-item ">
        <a href="/docs-csm/en-09/107-ncn-devel/">
        NCN Development
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/253-ncn-hw-swap/" title="NCN Hardware Swaps" class="dd-item ">
        <a href="/docs-csm/en-09/253-ncn-hw-swap/">
        NCN Hardware Swaps
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/110-ncn-image-customization/" title="NCN Image Customization" class="dd-item ">
        <a href="/docs-csm/en-09/110-ncn-image-customization/">
        NCN Image Customization
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/303-ncn-metadata-usb-serial/" title="NCN Metadata over USB-Serial Cable" class="dd-item ">
        <a href="/docs-csm/en-09/303-ncn-metadata-usb-serial/">
        NCN Metadata over USB-Serial Cable
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/106-ncn-sles/" title="NCN Operating System Release" class="dd-item ">
        <a href="/docs-csm/en-09/106-ncn-sles/">
        NCN Operating System Release
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/105-ncn-packages/" title="NCN Packages" class="dd-item ">
        <a href="/docs-csm/en-09/105-ncn-packages/">
        NCN Packages
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/104-ncn-partitioning/" title="NCN Partitions" class="dd-item ">
        <a href="/docs-csm/en-09/104-ncn-partitioning/">
        NCN Partitions
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/009-ncn-locking/" title="NCN/Management Node Locking" class="dd-item ">
        <a href="/docs-csm/en-09/009-ncn-locking/">
        NCN/Management Node Locking
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/251-firmware-network/" title="Network Firmware" class="dd-item ">
        <a href="/docs-csm/en-09/251-firmware-network/">
        Network Firmware
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/052-network-stack/" title="Network Stack (Software and Hardware)" class="dd-item ">
        <a href="/docs-csm/en-09/052-network-stack/">
        Network Stack (Software and Hardware)
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/103-ncn-networking/" title="Networking" class="dd-item ">
        <a href="/docs-csm/en-09/103-ncn-networking/">
        Networking
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/252-firmware-ncn/" title="Node Firmware" class="dd-item ">
        <a href="/docs-csm/en-09/252-firmware-ncn/">
        Node Firmware
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/100-ncn-images/" title="Non-Compute Node Images" class="dd-item ">
        <a href="/docs-csm/en-09/100-ncn-images/">
        Non-Compute Node Images
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/108-ncn-ntp/" title="NTP On NCNs" class="dd-item ">
        <a href="/docs-csm/en-09/108-ncn-ntp/">
        NTP On NCNs
        
        </a>
    </li>
     
  
 

      
      




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/" title="operations" class="dd-item
        parent
        
        
        ">
      <a href="/docs-csm/en-09/operations/">
          operations
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/boot_orchestration/" title="boot orchestration" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/boot_orchestration/">
          boot orchestration
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/boot_orchestration/stage_changes_without_bos/" title="Stage Changes Without BOS" class="dd-item ">
        <a href="/docs-csm/en-09/operations/boot_orchestration/stage_changes_without_bos/">
        Stage Changes Without BOS
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/boot_orchestration/upload_node_boot_information_to_boot_script_service_bss/" title="Upload Node Boot Information to Boot Script Service (BSS)" class="dd-item ">
        <a href="/docs-csm/en-09/operations/boot_orchestration/upload_node_boot_information_to_boot_script_service_bss/">
        Upload Node Boot Information to Boot Script Service (BSS)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/configuration_management/" title="configuration management" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/configuration_management/">
          configuration management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/configuration_management/configuration_layers/" title="Configuration Layers" class="dd-item ">
        <a href="/docs-csm/en-09/operations/configuration_management/configuration_layers/">
        Configuration Layers
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/csm_product_management/" title="CSM product management" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/csm_product_management/">
          CSM product management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/csm_product_management/apply_security_hardening/" title="Security Hardening" class="dd-item ">
        <a href="/docs-csm/en-09/operations/csm_product_management/apply_security_hardening/">
        Security Hardening
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/csm_product_management/change_passwords_and_credentials/" title="Change Passwords and Credentials" class="dd-item ">
        <a href="/docs-csm/en-09/operations/csm_product_management/change_passwords_and_credentials/">
        Change Passwords and Credentials
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/kubernetes/" title="kubernetes" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/kubernetes/">
          kubernetes
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/kubernetes/cert_renewal_for_kubernetes_and_bare_metal_etcd/" title="Kubernetes and Bare Metal EtcD Certificate Renewal" class="dd-item ">
        <a href="/docs-csm/en-09/operations/kubernetes/cert_renewal_for_kubernetes_and_bare_metal_etcd/">
        Kubernetes and Bare Metal EtcD Certificate Renewal
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/network/" title="network" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/network/">
          network
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/network/metallb_bgp/" title="metallb bgp" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/network/metallb_bgp/">
          metallb bgp
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/network/metallb_bgp/check_bgp_status_and_reset_sessions/" title="Check BGP Status and Reset Sessions" class="dd-item ">
        <a href="/docs-csm/en-09/operations/network/metallb_bgp/check_bgp_status_and_reset_sessions/">
        Check BGP Status and Reset Sessions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/system_management_health/" title="system management health" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/system_management_health/">
          system management health
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/system_management_health/troubleshoot_prometheus_alerts/" title="Troubleshoot Prometheus Alerts" class="dd-item ">
        <a href="/docs-csm/en-09/operations/system_management_health/troubleshoot_prometheus_alerts/">
        Troubleshoot Prometheus Alerts
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/fas_loader/" title="FAS Loader" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/fas_loader/">
          FAS Loader
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/fas_loader/fas_loader_fails/" title="TROUBLESHOOTING FAS LOADER FAILS" class="dd-item ">
        <a href="/docs-csm/en-09/operations/fas_loader/fas_loader_fails/">
        TROUBLESHOOTING FAS LOADER FAILS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/hmcollector/" title="hmcollector" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/hmcollector/">
          hmcollector
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/hmcollector/adjust_hmcollector_resource_limits_requests/" title="Adjust HM Collector resource limits and requests" class="dd-item ">
        <a href="/docs-csm/en-09/operations/hmcollector/adjust_hmcollector_resource_limits_requests/">
        Adjust HM Collector resource limits and requests
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/" title="security and authentication" class="dd-item
        parent
        
        
        ">
      <a href="/docs-csm/en-09/operations/security_and_authentication/">
          security and authentication
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/add_ldap_user_federation/" title="Add LDAP User Federation" class="dd-item active">
        <a href="/docs-csm/en-09/operations/security_and_authentication/add_ldap_user_federation/">
        Add LDAP User Federation
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/change_air-cooled_node_bmc_credentials/" title="Change Air-Cooled Node BMC Credentials" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/change_air-cooled_node_bmc_credentials/">
        Change Air-Cooled Node BMC Credentials
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/change_credentials_on_servertech_pdus/" title="Change Credentials on ServerTech PDUs" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/change_credentials_on_servertech_pdus/">
        Change Credentials on ServerTech PDUs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/change_ex_cabinet_global_default_password/" title="Change Cray EX Cabinet Global Default Password" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/change_ex_cabinet_global_default_password/">
        Change Cray EX Cabinet Global Default Password
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/change_ncn_image_root_password_and_ssh_keys/" title="Change NCN Image Root Password and SSH Keys" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/change_ncn_image_root_password_and_ssh_keys/">
        Change NCN Image Root Password and SSH Keys
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/change_ncn_image_root_password_and_ssh_keys_on_pit_node/" title="Change NCN Image Root Password and SSH Keys on PIT Node" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/change_ncn_image_root_password_and_ssh_keys_on_pit_node/">
        Change NCN Image Root Password and SSH Keys on PIT Node
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/change_smnp_credentials_on_leaf_switches/" title="Change SMNP Credentials on Leaf Switches" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/change_smnp_credentials_on_leaf_switches/">
        Change SMNP Credentials on Leaf Switches
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/change_the_keycloak_admin_password/" title="Change the Keycloak Admin Password" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/change_the_keycloak_admin_password/">
        Change the Keycloak Admin Password
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/provisioning_a_liquid-cooled_ex_cabinet_cec_with_default_credentials/" title="Provisioning a Liquid-Cooled EX Cabinet CEC with Default Credentials" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/provisioning_a_liquid-cooled_ex_cabinet_cec_with_default_credentials/">
        Provisioning a Liquid-Cooled EX Cabinet CEC with Default Credentials
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/restrict_access_to_ncn_images_s3_bucket/" title="Restrict Network Access to the ncn-images S3 Bucket" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/restrict_access_to_ncn_images_s3_bucket/">
        Restrict Network Access to the ncn-images S3 Bucket
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/update_default_air-cooled_bmc_and_leaf_switch_snmp_credentials/" title="Update Default Air-Cooled BMC and Leaf Switch SNMP Credentials" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/update_default_air-cooled_bmc_and_leaf_switch_snmp_credentials/">
        Update Default Air-Cooled BMC and Leaf Switch SNMP Credentials
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/update_default_servertech_pdu_credentials_used_by_the_redfish_translation_service/" title="Update Default ServerTech PDU Credentials used by the Redfish Translation Service (RTS)" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/update_default_servertech_pdu_credentials_used_by_the_redfish_translation_service/">
        Update Default ServerTech PDU Credentials used by the Redfish Translation Service (RTS)
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/update_ncn_passwords/" title="Update NCN Passwords" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/update_ncn_passwords/">
        Update NCN Passwords
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/security_and_authentication/updating_the_liquid-cooled_ex_cabinet_default_credentials_after_a_cec_password_change/" title="Updating the Liquid-Cooled EX Cabinet Default Credentials after a CEC Password Change" class="dd-item ">
        <a href="/docs-csm/en-09/operations/security_and_authentication/updating_the_liquid-cooled_ex_cabinet_default_credentials_after_a_cec_password_change/">
        Updating the Liquid-Cooled EX Cabinet Default Credentials after a CEC Password Change
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/operations/node_management/" title="node management" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/operations/node_management/">
          node management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/node_management/adding_a_liquid-cooled_blade_to_a_system/" title="Adding a Liquid-cooled blade to a System" class="dd-item ">
        <a href="/docs-csm/en-09/operations/node_management/adding_a_liquid-cooled_blade_to_a_system/">
        Adding a Liquid-cooled blade to a System
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/node_management/check_and_set_the_metalno-wipe_setting_on_ncns/" title="Check and Set the metal.no-wipe Setting on NCNs" class="dd-item ">
        <a href="/docs-csm/en-09/operations/node_management/check_and_set_the_metalno-wipe_setting_on_ncns/">
        Check and Set the metal.no-wipe Setting on NCNs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/node_management/enable_kdump/" title="Enable Kdump" class="dd-item ">
        <a href="/docs-csm/en-09/operations/node_management/enable_kdump/">
        Enable Kdump
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/node_management/reboot_ncns/" title="Reboot NCNs" class="dd-item ">
        <a href="/docs-csm/en-09/operations/node_management/reboot_ncns/">
        Reboot NCNs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/operations/node_management/removing_a_liquid-cooled_blade_from_a_system/" title="Removing a Liquid-cooled blade from a System" class="dd-item ">
        <a href="/docs-csm/en-09/operations/node_management/removing_a_liquid-cooled_blade_from_a_system/">
        Removing a Liquid-cooled blade from a System
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/055-certificate-authority/" title="Overview" class="dd-item ">
        <a href="/docs-csm/en-09/055-certificate-authority/">
        Overview
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/401-management-network-install/" title="Overview" class="dd-item ">
        <a href="/docs-csm/en-09/401-management-network-install/">
        Overview
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/420-mgmt-net-pxe-tshoot/" title="PXE boot Troubleshooting" class="dd-item ">
        <a href="/docs-csm/en-09/420-mgmt-net-pxe-tshoot/">
        PXE boot Troubleshooting
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/065-csm-safeguards/" title="Safeguards" class="dd-item ">
        <a href="/docs-csm/en-09/065-csm-safeguards/">
        Safeguards
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/300-service-guides/" title="Service Guides" class="dd-item ">
        <a href="/docs-csm/en-09/300-service-guides/">
        Service Guides
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/067-shasta-cfg/" title="Setup Site-Init From SHASTA-CFG" class="dd-item ">
        <a href="/docs-csm/en-09/067-shasta-cfg/">
        Setup Site-Init From SHASTA-CFG
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/305-switch-metadata/" title="Switch Metadata" class="dd-item ">
        <a href="/docs-csm/en-09/305-switch-metadata/">
        Switch Metadata
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/500-uas-uai-admin-and-user-guide/" title="The Shasta User Access Service" class="dd-item ">
        <a href="/docs-csm/en-09/500-uas-uai-admin-and-user-guide/">
        The Shasta User Access Service
        
        </a>
    </li>
     
  
 

      
      




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/" title="upgrade" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/">
          upgrade
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/" title="CSM 0.9 Patch Release Upgrade Procedures" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/">
          CSM 0.9 Patch Release Upgrade Procedures
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.6/" title="CSM 0.9.6 Patch Installation Instructions" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.6/">
          CSM 0.9.6 Patch Installation Instructions
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.4/" title="CSM 0.9.4 Patch Upgrade Guide" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.4/">
          CSM 0.9.4 Patch Upgrade Guide
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/" title="CVE-2021-22555 CVE-2021-33909" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/">
          CVE-2021-22555 CVE-2021-33909
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/" title="operations" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/">
          operations
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/network/" title="network" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/network/">
          network
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/network/metallb_bgp/" title="metallb bgp" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/network/metallb_bgp/">
          metallb bgp
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/network/metallb_bgp/check_bgp_status_and_reset_sessions/" title="Check BGP Status and Reset Sessions" class="dd-item ">
        <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/network/metallb_bgp/check_bgp_status_and_reset_sessions/">
        Check BGP Status and Reset Sessions
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/node_management/" title="node management" class="dd-item
        
        
        
        ">
      <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/node_management/">
          node management
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/node_management/check_and_set_the_metalno-wipe_setting_on_ncns/" title="Check and Set the metal.no-wipe Setting on NCNs" class="dd-item ">
        <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/node_management/check_and_set_the_metalno-wipe_setting_on_ncns/">
        Check and Set the metal.no-wipe Setting on NCNs
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/node_management/reboot_ncns/" title="Reboot NCNs" class="dd-item ">
        <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.5/operations/node_management/reboot_ncns/">
        Reboot NCNs
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.2/" title="CSM 0.9.2 Patch Upgrade Guide" class="dd-item ">
        <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.2/">
        CSM 0.9.2 Patch Upgrade Guide
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/docs-csm/en-09/upgrade/0.9/csm-0.9.3/" title="CSM 0.9.3 Patch Upgrade Guide" class="dd-item ">
        <a href="/docs-csm/en-09/upgrade/0.9/csm-0.9.3/">
        CSM 0.9.3 Patch Upgrade Guide
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/069-upgrade-workarounds-rpm/" title="Upgrade CSM Install Workarounds RPM" class="dd-item ">
        <a href="/docs-csm/en-09/069-upgrade-workarounds-rpm/">
        Upgrade CSM Install Workarounds RPM
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/070-usp-install-workarounds/" title="Utility Storage Installation Troubleshooting" class="dd-item ">
        <a href="/docs-csm/en-09/070-usp-install-workarounds/">
        Utility Storage Installation Troubleshooting
        
        </a>
    </li>
     
  
 

      
      




 
  
    
      <li data-nav-id="/docs-csm/en-09/400-switch-bgp-neighbors/" title="Verify and Update BGP neighbors" class="dd-item ">
        <a href="/docs-csm/en-09/400-switch-bgp-neighbors/">
        Verify and Update BGP neighbors
        
        </a>
    </li>
     
  
 

      
    </ul>

    
    

    
    <section id="footer">
      
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/docs-csm/en-09/'>CRAY System Management - Guides and References</a> > <a href='/docs-csm/en-09/operations/'>operations</a> > <a href='/docs-csm/en-09/operations/security_and_authentication/'>security and authentication</a> > Add LDAP User Federation
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#add-ldap-user-federation">Add LDAP User Federation</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#procedure">Procedure</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
            </h1>
          

        


<h2 id="add-ldap-user-federation">Add LDAP User Federation</h2>
<p>Add LDAP user federation using the Keycloak localization tool.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>LDAP user federation is not currently configured in Keycloak. For example, if it was not configured in Keycloak when the system was initially installed or the LDAP user federation was removed.</p>
<h3 id="procedure">Procedure</h3>
<ol>
<li>
<p>Prepare to customize the customizations.yaml file.</p>
<p>If the customizations.yaml file is managed in an external Git repository (as recommended), then clone a local working tree. Replace the <code>&lt;URL&gt;</code> value in the following command before running it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git clone &lt;URL&gt; /root/site-init
</span></span><span style="display:flex;"><span>ncn-m001# cd /root/site-init
</span></span></code></pre></div><p>If there is not a backup of site-init, perform the following steps to create a new one using the values stored in the Kubernetes cluster.</p>
<ol>
<li>
<p>Create a new site-init directory using the CSM tarball.</p>
<p>Determine the location of the initial unpacked install tarball and set ${CSM_DISTDIR} accordingly.</p>
<blockquote>
<p><strong>NOTE:</strong> If the unpacked set of CSM directories was copied, no untar action is required. If the tarball tgz file was copied, the command to unpack it is <code>tar -zxvf CSM_RELEASE.tar.gz</code>. Replace the <em>CSM_RELEASE</em> value before running the command to unpack the tarball.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cp -r <span style="color:#e6db74">${</span>CSM_DISTDIR<span style="color:#e6db74">}</span>/shasta-cfg/* /root/site-init
</span></span><span style="display:flex;"><span>ncn-m001# cd /root/site-init
</span></span></code></pre></div></li>
<li>
<p>Extract customizations.yaml from the site-init secret.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl -n loftsman get secret site-init -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.data.customizations\.yaml}&#39;</span> | base64 -d - &gt; customizations.yaml
</span></span></code></pre></div></li>
<li>
<p>Extract the certificate and key used to create the sealed secrets.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl -n kube-system get secret sealed-secrets-key -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.data.tls\.crt}&#39;</span> | base64 -d - &gt; certs/sealed_secrets.crt
</span></span><span style="display:flex;"><span>ncn-m001# kubectl -n kube-system get secret sealed-secrets-key -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.data.tls\.key}&#39;</span> | base64 -d - &gt; certs/sealed_secrets.key
</span></span></code></pre></div></li>
</ol>
</li>
</ol>
<blockquote>
<p><strong>NOTE:</strong> All subsequent steps of this procedure should be performed within the <code>/root/site-init</code> directory created in this step.</p>
</blockquote>
<ol start="2">
<li>
<p>Repopulate the keycloak_users_localize and cray-keycloak Sealed Secrets in the customizations.yaml file with the desired configuration.</p>
<p>Update the LDAP settings with the desired configuration. LDAP connection information
is stored in the keycloak-users-localize Secret in the customizations.yaml file.</p>
<ul>
<li>The ldap_connection_url key is required and is set to an LDAP URL.</li>
<li>The ldap_bind_dn and ldap_bind_credentials keys are optional.</li>
<li>If the LDAP server requires authentication. then the bind DN and credentials are set in these keys respectively.</li>
</ul>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>      cray-keycloak:
</span></span><span style="display:flex;"><span>          generate:
</span></span><span style="display:flex;"><span>            name: keycloak-certs
</span></span><span style="display:flex;"><span>            data:
</span></span><span style="display:flex;"><span>              - type: static_b64
</span></span><span style="display:flex;"><span>                args:
</span></span><span style="display:flex;"><span>                  name: certs.jks
</span></span><span style="display:flex;"><span>                  value: /u3+7QAAAAIAAAAA5yXvSDt11bGXyBA9M2iy0/5i1Tg<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      keycloak_users_localize:
</span></span><span style="display:flex;"><span>          generate:
</span></span><span style="display:flex;"><span>            name: keycloak-users-localize
</span></span><span style="display:flex;"><span>            data:
</span></span><span style="display:flex;"><span>              - type: static
</span></span><span style="display:flex;"><span>                args:
</span></span><span style="display:flex;"><span>                  name: ldap_connection_url
</span></span><span style="display:flex;"><span>                  value: <span style="color:#e6db74">&#34;ldaps://my_ldap.my_org.test&#34;</span>
</span></span><span style="display:flex;"><span>              - type: static
</span></span><span style="display:flex;"><span>                args:
</span></span><span style="display:flex;"><span>                  name: ldap_bind_dn
</span></span><span style="display:flex;"><span>                  value: <span style="color:#e6db74">&#34;cn=my_admin&#34;</span>
</span></span><span style="display:flex;"><span>              - type: static
</span></span><span style="display:flex;"><span>                args:
</span></span><span style="display:flex;"><span>                  name: ldap_bind_credentials
</span></span><span style="display:flex;"><span>                  value: <span style="color:#e6db74">&#34;my_ldap_admin_password&#34;</span>
</span></span></code></pre></div><p>The example above puts an empty certs.jks in the cray-keycloak Sealed Secret.
The next step will generate certs.jks.</p>
<p>Other LDAP configuration settings are set in the spec.kubernetes.services.cray-keycloak-users-localize field in the customizations.yaml file.</p>
<p>The fields are as follows:</p>
<pre tabindex="0"><code>(
Notes for the following table: format is

  * &lt;cray-keycloak-users-localize chart option name&gt; : &lt;description&gt;
    - default: &lt;the default value if not overridden in customizations.yaml
    - type: &lt;type that the value in customizations.yaml has to be. e.g., if type is string and a number is entered then you need to quote it&gt;
    - allowed values: &lt;if only certain values are allowed they are listed here&gt;
  )

  * ldapProviderId : The Keycloak provider ID for the component. This must be &#34;ldap&#34;
    - default: ldap
    - type: string
  * ldapFederationName : The name of the LDAP provider in Keycloak. If a provider with this name already exists then this tool will not create a new provider.
    - default: shasta-user-federation-ldap
    - type: string
  * ldapPriority : The priority of this provider when looking up users or adding a user.
    - default: 1
    - type: string
  * ldapEditMode : If you want to be able to create or change users in Keycloak and have them created or modified in the LDAP server, and the LDAP server allows it, then this can be changed.
    - default: READ_ONLY
    - type: string
    - allowed values: READ_ONLY, WRITEABLE, or UNSYNCED
  * ldapSyncRegistrations : If true, then newly created users will be created in the LDAP server.
    - default: false
    - type: string
    - allowed values: true or false
  * ldapVendor: This determines some defaults for what mappers are created by default.
    - default: other
    - type: string
    - allowed values: Active Directory, Red Hat Directory Server, Tivoli, Novell eDirectory, or other
  * ldapUsernameLDAPAttribute: The LDAP attribute to map to the username in Keycloak.
    - default: uid
    - type: string
  * ldapRdnLDAPAttribute: The LDAP attribute being used as the users RDN.
    - default: uid
    - type: string
  * ldapUuidLDAPAttribute: The LDAP attribute being used as a unique ID.
    - default: uid
    - type: string
  * ldapUserObjectClasses: The object classes for user entries.
    - default: posixAccount
    - type: comma-separated string
  * ldapAuthType: Set to &#34;none&#34; if the LDAP server allows anonymous search for users and groups, otherwise set to &#34;simple&#34; to bind.
    - default: none
    - type: string
    - allowed values: none or simple
  * ldapSearchBase: The DN for the base entry to search for users and groups.
    - default: cn=default
    - type: string
  * ldapSearchScope: The search scope to use when searching for users or groups: 2 for subtree, 1 for onelevel
    - default: 2
    - type: string
    - allowed values: 1 or 2
  * ldapUseTruststoreSpi: Determines if the truststore is used to validate the server certificate when connecting to the server.
    - default: ldapsOnly
    - type: string
    - allowed values: ldapsOnly, always, never
  * ldapConnectionPooling: If true then Keycloak will use a connection pool of LDAP connections.
    - default: true
    - type: string
    - allowed values: true or false
  * ldapPagination: Set to true if the LDAP server supports or requires use of the paging extension.
    - default: true
    - type: string
    - allowed values: true or false
  * ldapAllowKerberosAuthentication:
    - Set to true to enable HTTP authentication of users with SPNEGO/Kerberos tokens.
    - default: false
    - type: string
  * ldapBatchSizeForSync: Count of LDAP users to be imported from LDAP to Keycloak in a single transaction.
    - default: 4000
    - type: string
  * ldapFullSyncPeriod: If a positive number, this is the number of seconds between automatic full user synchronization operations; if negative then full user synchronization operations will not be done automatically.
    - default: -1
    - type: string
  * ldapChangedSyncPeriod: f a positive number, this is the number of seconds between automatic changed user synchronization operations; if negative then changed user synchronization operations will not be done automatically.
    - default: -1
    - type: string
  * ldapDebug: Set to true to enable extra logging of LDAP operations.
    - default: true
    - allowed values: true or false
  * ldapUserAttributeMappers: Extra attribute mappers to create so that users have attributes required by Shasta software. The Keycloak attribute that the LDAP attribute maps to will be the same.
    - default: [uidNumber, gidNumber, loginShell, homeDirectory]
    - type: list of strings
  * ldapUserAttributeMappersToRemove: These attribute mappers will be removed, to be used in the case where the default attribute mappers are not appropriate. For example, this could be used to remove the email mapper if email addresses are not unique.
    - default: []
    - type: list of strings
  * ldapGroupNameLDAPAttribute: The LDAP attribute to map to the group name in Keycloak.
    - default: cn
    - type: string
  * ldapGroupObjectClass: The object classes for group entries.
    - default: posixGroup
    - type: comma-separated string
  * ldapPreserveGroupInheritance: Whether group inheritance should be propagated to Keycloak or not.
    - default: false
    - type: string
    - allowed values: true or false
  * ldapMembershipLDAPAttribute: Name of the LDAP attribute that refers to the group members.
    - default: memberUid
    - type: string
  * ldapMembershipAttributeType: If the member attribute contains the DN for the user, then set this to DN. If the member attribute is the UID of the entry then set this to UID.
    - default: UID
    - type: string
    - allowed values: UID or DN
  * ldapMembershipUserLDAPAttribute: If the ldapMembershipAttributeType is UID then this is the LDAP attribute containing the UID value, otherwise this is ignored.
    - default: uid
    - type: string
  * ldapGroupsLDAPFilter: Extra filter to include when searching for group entries. If this is not the empty string the value must start with the ( character and end with ).
    - default: &#34;&#34;
    - type: string
  * ldapUserRolesRetrieveStrategy: Defines how to retrieve groups for a user.
    - default: LOAD_GROUPS_BY_MEMBER_ATTRIBUTE
    - type: string
    - allowed values: LOAD_GROUPS_BY_MEMBER_ATTRIBUTE, GET_GROUPS_FROM_USER_MEMBEROF_ATTRIBUTE, LOAD_GROUPS_BY_MEMBER_ATTRIBUTE_RECURSIVELY
  * ldapMappedGroupAttributes: Attributes of the group that will be added as attributes of the user. Some Shasta REST API operations require the user to have a gidNumber and this adds that attribute from the LDAP group.
    - default: cn,gidNumber,memberUid
    - type: comma-separated string
  * ldapDropNonExistingGroupsDuringSync: If true, groups that are not in LDAP will be deleted when synchronizing.
    - default: false
    - type: string
    - allowed values: true or false
  * ldapDoFullSync: Tells the HPE Cray EX Keycloak localization tool to perform an immediate full user synchronization after configuring the LDAP integration.
    - default: true
    - type: string
  * ldapRoleMapperDn: If this is an empty string then a role mapper is not created, otherwise this the the DN used as the search base to find role entries.
    - default: &#34;&#34;
    - type: string
  * ldapRoleMapperRoleNameLDAPAttribute: The LDAP attribute to map to the role name in Keycloak.
    - default: cn
    - type: string
  * ldapRoleMapperRoleObjectClasses: The object classes for role entries.
    - default: groupOfNames
    - type: string
  * ldapRoleMapperLDAPAttribute: Name of the LDAP attribute that refers to the group members.
    - default: member
    - type: string
  * ldapRoleMapperMemberAttributeType: If the member attribute contains the DN for the user, then set this to DN. If the member attribute is the UID of the entry then set this to UID.
    - default: DN
    - type: string
    - allowed values: UID or DN
  * ldapRoleMapperUserLDAPAttribute: If the ldapRoleMapperMemberAttributeType is UID then this is the LDAP attribute containing the UID value, otherwise this is ignored.
    - default: sAMAccountName
    - type: string
  * ldapRoleMapperRolesLDAPFilter: Extra filter to include when searching for group entries. If this is not the empty string the value must start with the ( character and end with ).
    - default: &#34;&#34;
    - type: string
  * ldapRoleMapperMode: Specifies how to retrieve roles for the user.
    - default: READ_ONLY
    - allowed values: READ_ONLY, LDAP_ONLY, or IMPORT
  * ldapRoleMapperStrategy: Defines how to retrieve roles for a user.
    - default: LOAD_ROLES_BY_MEMBER_ATTRIBUTE
    - type: string
    - allowed values: LOAD_ROLES_BY_MEMBER_ATTRIBUTE, GET_ROLES_FROM_MEMBEROF_ATTRIBUTE, or LOAD_ROLES_BY_MEMBER_ATTRIBUTE_RECURSIVELY
  * ldapRoleMapperMemberOfLDAPAttribute: Only used when ldapRoleMapperStrategy is GET_ROLES_FROM_MEMBEROF_ATTRIBUTE where it is the LDAP attribute in the user entry that contains the roles that the user has.
    - default: memberOf
    - type: string
  * ldapRoleMapperUseRealmRolesMapping: If true then LDAP role mappings will be mapped to realm role mappings in Keycloak, otherwise the LDAP role mappings will be mapped to client role mappings.
    - default: false
    - type: string
    - allowed values: true or false
  * ldapRoleMapperClientId: If ldapRoleMapperUseRealmRolesMapping is false then this is the client ID to apply the roles to.
      - default: shasta
      - type: string
</code></pre></li>
<li>
<p>(Optional) Add the LDAP CA certificate in the certs.jks section of customizations.yaml.</p>
<p>If LDAP requires TLS (recommended), update the <code>cray-keycloak</code> Sealed
Secret value by supplying a base64 encoded Java KeyStore (JKS) that
contains the CA certificate that signed the LDAP server&rsquo;s host key. The
password for the JKS file must be <code>password</code>.</p>
<p>Administrators may use the <code>keytool</code> command from the <code>openjdk:11-jre-slim</code> container image
packaged with CSM to create a JKS file that includes a PEM-encoded
CA certificate to verify the LDAP host(s).</p>
<ol>
<li>
<p>Load the <code>openjdk</code> container image.</p>
<blockquote>
<p><strong>NOTE:</strong> Requires a properly configured Docker or Podman environment.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# <span style="color:#e6db74">${</span>CSM_DISTDIR<span style="color:#e6db74">}</span>/hack/load-container-image.sh dtr.dev.cray.com/library/openjdk:11-jre-slim
</span></span></code></pre></div><p><strong>Troubleshooting:</strong></p>
<ul>
<li>
<p>If the output shows the skopeo.tar file cannot be found, ensure that the $CSM_DISTDIR directory looks correct, and contains the <code>dtr.dev.cray.com</code> directory that includes the originally installed docker images.</p>
<p>The following is an example of the skopeo.tar file not being found:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>++ podman load -q -i ./hack/../vendor/skopeo.tar
</span></span><span style="display:flex;"><span>++ sed -e <span style="color:#e6db74">&#39;s/^.*: //&#39;</span>
</span></span><span style="display:flex;"><span>+ SKOPEO_IMAGE<span style="color:#f92672">=</span>
</span></span></code></pre></div></li>
<li>
<p>If the following overlay error is returned, it could be caused by an earlier podman invocation using a different configuration:</p>
<pre tabindex="0"><code>&#34;ERRO[0000] [graphdriver] prior storage driver overlay failed: &#39;overlay&#39; is not supported over overlayfs, a mount_program is required: backing file system is unsupported for this graph driver&#34;
</code></pre><p>To recover podman, move the overlay directories to a backup folder as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# mkdir /var/lib/containers/storage/backup
</span></span><span style="display:flex;"><span>ncn-m001# mv /var/lib/containers/storage/overlay* /var/lib/containers/storage/backup
</span></span></code></pre></div><p>This should allow load-container-images.sh to succeed.</p>
</li>
</ul>
</li>
<li>
<p>Create (or update) <code>cert.jks</code> with the PEM-encoded CA certificate for an LDAP host.</p>
<blockquote>
<p><strong>IMPORTANT:</strong> Replace <code>&lt;ca-cert.pem&gt;</code> and <code>&lt;alias&gt;</code> before running the command.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# podman run --rm -v <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span><span style="color:#e6db74">:/data&#34;</span> dtr.dev.cray.com/library/openjdk:11-jre-slim keytool <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-importcert -trustcacerts -file /data/&lt;ca-cert.pem&gt; -alias &lt;alias&gt; -keystore /data/certs.jks <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-storepass password -noprompt
</span></span></code></pre></div></li>
<li>
<p>Set variables for the LDAP server.</p>
<p>In the following example, the LDAP server has the hostname <code>dcldap2.hpc.amslabs.hpecorp.net</code> and is using the port 636.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# export LDAP<span style="color:#f92672">=</span>dcldap2.hpc.amslabs.hpecorp.net
</span></span><span style="display:flex;"><span>ncn-m001# export PORT<span style="color:#f92672">=</span><span style="color:#ae81ff">636</span>
</span></span></code></pre></div></li>
<li>
<p>Get the issuer certificate for the LDAP server at port 636. Use <code>openssl s_client</code> to connect
and show the certificate chain returned by the LDAP host.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# openssl s_client -showcerts -connect $LDAP:<span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> &lt;/dev/null
</span></span></code></pre></div><p>Either manually extract (cut/paste) the issuer&rsquo;s
certificate into <code>cacert.pem</code>, or try the following commands to
create it automatically.</p>
<blockquote>
<p><strong>NOTE:</strong> The following commands were verified using OpenSSL
version 1.1.1d and use the <code>-nameopt RFC2253</code> option to ensure
consistent formatting of distinguished names (DNs).
Unfortunately, older versions of OpenSSL may not support
<code>-nameopt</code> on the <code>s_client</code> command or may use a different
default format. As a result, mileage may vary; however,
administrators should be able to extract the issuer certificate manually
from the output of the above <code>openssl s_client</code> example if the
following commands are unsuccessful.</p>
</blockquote>
<p>Observe the issuer&rsquo;s DN.</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# openssl s_client -showcerts -nameopt RFC2253 -connect $LDAP:<span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> &lt;/dev/null 2&gt;/dev/null | grep issuer<span style="color:#f92672">=</span> | sed -e <span style="color:#e6db74">&#39;s/^issuer=//&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>emailAddress<span style="color:#f92672">=</span>dcops@hpe.com,CN<span style="color:#f92672">=</span>Data Center,OU<span style="color:#f92672">=</span>HPC/MCS,O<span style="color:#f92672">=</span>HPE,ST<span style="color:#f92672">=</span>WI,C<span style="color:#f92672">=</span>US
</span></span></code></pre></div><p>Then, extract the issuer&rsquo;s certificate using the <code>awk</code> command:</p>
<blockquote>
<p><strong>NOTE:</strong> The issuer DN is properly escaped as part of the
<code>awk</code> pattern below. If the value being used is
different, be sure to escape it properly!</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# openssl s_client -showcerts -nameopt RFC2253 -connect $LDAP:<span style="color:#e6db74">${</span>PORT<span style="color:#e6db74">}</span> &lt;/dev/null 2&gt;/dev/null | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        awk <span style="color:#e6db74">&#39;/s:emailAddress=dcops@hpe.com,CN=Data Center,OU=HPC\/MCS,O=HPE,ST=WI,C=US/,/END CERTIFICATE/&#39;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>        awk <span style="color:#e6db74">&#39;/BEGIN CERTIFICATE/,/END CERTIFICATE/&#39;</span> &gt; cacert.pem
</span></span></code></pre></div></li>
<li>
<p>Verify the issuer&rsquo;s certificate was properly extracted and saved in <code>cacert.pem</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cat cacert.pem
</span></span></code></pre></div><p>Expected output looks similar to the following:</p>
<pre tabindex="0"><code>-----BEGIN CERTIFICATE-----
MIIDvTCCAqWgAwIBAgIUYxrG/PrMcmIzDuJ+U1Gh8hpsU8cwDQYJKoZIhvcNAQEL
BQAwbjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAldJMQwwCgYDVQQKDANIUEUxEDAO
BgNVBAsMB0hQQy9NQ1MxFDASBgNVBAMMC0RhdGEgQ2VudGVyMRwwGgYJKoZIhvcN
AQkBFg1kY29wc0BocGUuY29tMB4XDTIwMTEyNDIwMzM0MVoXDTMwMTEyMjIwMzM0
MVowbjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAldJMQwwCgYDVQQKDANIUEUxEDAO
BgNVBAsMB0hQQy9NQ1MxFDASBgNVBAMMC0RhdGEgQ2VudGVyMRwwGgYJKoZIhvcN
AQkBFg1kY29wc0BocGUuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEAuBIZkKitHHVQHymtaQt4D8ZhG4qNJ0cTsLhODPMtVtBjPZp59e+PWzbc9Rj5
+wfjLGteK6/fNJsJctWlS/ar4jw/xBIPMk5pg0dnkMT2s7lkSCmyd9Uib7u6y6E8
yeGoGcb7I+4ZI+E3FQV7zPact6b17xmajNyKrzhBGEjYucYJUL5iTgZ6a7HOZU2O
aQSXe7ctiHBxe7p7RhHCuKRrqJnxoohakloKwgHHzDLFQzX/5ADp1hdJcduWpaXY
RMBu6b1mhmwo5vmc+fDnfUpl5/X4i109r9VN7JC7DQ5+JX8u9SHDGLggBWkrhpvl
bNXMVCnwnSFfb/rnmGO7rdJSpwIDAQABo1MwUTAdBgNVHQ4EFgQUVg3VYExUAdn2
WE3e8Xc8HONy/+4wHwYDVR0jBBgwFoAUVg3VYExUAdn2WE3e8Xc8HONy/+4wDwYD
VR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAWLDQLB6rrmK+gwUY+4B7
0USbQK0JkLWuc0tCfjTxNQTzFb75PeH+GH21QsjUI8VC6QOAAJ4uzIEV85VpOQPp
qjz+LI/Ej1xXfz5ostZQu9rCMnPtVu7JT0B+NV7HvgqidTfa2M2dw9yUYS2surZO
8S0Dq3Bi6IEhtGU3T8ZpbAmAp+nNsaJWdUNjD4ECO5rAkyA/Vu+WyMz6F3ZDBmRr
ipWM1B16vx8rSpQpygY+FNX4e1RqslKhoyuzXfUGzyXux5yhs/ufOaqORCw3rJIx
v4sTWGsSBLXDsFM3lBgljSAHfmDuKdO+Qv7EqGzCRMpgSciZihnbQoRrPZkOHUxr
NA==
-----END CERTIFICATE-----
</code></pre></li>
<li>
<p>Create <code>certs.jks</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# podman run --rm -v <span style="color:#e6db74">&#34;</span><span style="color:#66d9ef">$(</span>pwd<span style="color:#66d9ef">)</span><span style="color:#e6db74">:/data&#34;</span> dtr.dev.cray.com/library/openjdk:11-jre-slim keytool -importcert <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-trustcacerts -file /data/cacert.pem -alias cray-data-center-ca -keystore /data/certs.jks <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>-storepass password -noprompt
</span></span></code></pre></div></li>
<li>
<p>Create <code>certs.jks.b64</code> by base-64 encoding <code>certs.jks</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# base64 certs.jks &gt; certs.jks.b64
</span></span></code></pre></div></li>
<li>
<p>Inject and encrypt <code>certs.jks.b64</code> into <code>customizations.yaml</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cat <span style="color:#e6db74">&lt;&lt;EOF | yq w - &#39;data.&#34;certs.jks&#34;&#39; &#34;$(&lt;certs.jks.b64)&#34; | \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yq r -j - | /root/site-init/utils/secrets-encrypt.sh | \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">yq w -f - -i /root/site-init/customizations.yaml &#39;spec.kubernetes.sealed_secrets.cray-keycloak&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;kind&#34;: &#34;Secret&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;apiVersion&#34;: &#34;v1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;metadata&#34;: {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;name&#34;: &#34;keycloak-certs&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;namespace&#34;: &#34;services&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;creationTimestamp&#34;: null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;data&#34;: {}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>Prepare to generate Sealed Secrets.</p>
<p>Secrets are stored in customizations.yaml as <code>SealedSecret</code> resources
(encrypted secrets), which are deployed by specific charts and decrypted by the
Sealed Secrets operator. But first, those Secrets must be seeded, generated, and
encrypted.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# ./utils/secrets-reencrypt.sh customizations.yaml ./certs/sealed_secrets.key ./certs/sealed_secrets.crt
</span></span></code></pre></div></li>
<li>
<p>Encrypt the static values in the customizations.yaml file after making changes.</p>
<p>The following command must be run within the site-init directory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# ./utils/secrets-seed-customizations.sh customizations.yaml
</span></span></code></pre></div><p>Expected output looks similar to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Creating Sealed Secret keycloak-certs
</span></span><span style="display:flex;"><span>Generating type static_b64...
</span></span><span style="display:flex;"><span>Creating Sealed Secret keycloak-master-admin-auth
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Generating type randstr...
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Creating Sealed Secret cray_reds_credentials
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Creating Sealed Secret cray_meds_credentials
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Creating Sealed Secret cray_hms_rts_credentials
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Creating Sealed Secret vcs-user-credentials
</span></span><span style="display:flex;"><span>Generating type randstr...
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Creating Sealed Secret generated-platform-ca-1
</span></span><span style="display:flex;"><span>Generating type platform_ca...
</span></span><span style="display:flex;"><span>Creating Sealed Secret pals-config
</span></span><span style="display:flex;"><span>Generating type zmq_curve...
</span></span><span style="display:flex;"><span>Generating type zmq_curve...
</span></span><span style="display:flex;"><span>Creating Sealed Secret munge-secret
</span></span><span style="display:flex;"><span>Generating type randstr...
</span></span><span style="display:flex;"><span>Creating Sealed Secret slurmdb-secret
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Generating type static...
</span></span><span style="display:flex;"><span>Generating type randstr...
</span></span><span style="display:flex;"><span>Generating type randstr...
</span></span><span style="display:flex;"><span>Creating Sealed Secret keycloak-users-localize
</span></span><span style="display:flex;"><span>Generating type static...
</span></span></code></pre></div></li>
<li>
<p>Decrypt the Sealed Secret to verify it was generated correctly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# ./utils/secrets-decrypt.sh keycloak_users_localize | jq -r <span style="color:#e6db74">&#39;.data.ldap_connection_url&#39;</span> | base64 --decode
</span></span><span style="display:flex;"><span>ldaps://my_ldap.my_org.test
</span></span></code></pre></div></li>
<li>
<p>Re-apply the cray-keycloak Helm chart with the updated customizations.yaml file.</p>
<ol>
<li>
<p>Retrieve the current platform.yaml manifest.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl -n loftsman get cm loftsman-platform -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.data.manifest\.yaml}&#39;</span> &gt; platform.yaml
</span></span></code></pre></div></li>
<li>
<p>Remove all charts from the platform.yaml except for cray-keycloak.</p>
<p>Edit the platform.yaml file and delete all sections starting with <code>-name: &lt;chart_name&gt;</code>, except for the cray-keycloak section.</p>
<p>Then, change the name of the manifest being deployed from platform to cray-keycloak:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001:# sed -i <span style="color:#e6db74">&#39;s/name: platform/name: cray-keycloak/&#39;</span> platform.yaml
</span></span></code></pre></div></li>
<li>
<p>Populate the platform manifest with data from the customizations.yaml file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# manifestgen -i platform.yaml -c customizations.yaml -o new-platform.yaml
</span></span></code></pre></div></li>
<li>
<p>Re-apply the platform manifest with the updated cray-keycloak chart.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# loftsman ship --manifest-path ./new-platform.yaml --charts-repo https://packages.local/repository/charts
</span></span></code></pre></div></li>
<li>
<p>Wait for the keycloak-certs secret to reflect the new <code>cert.jks</code>.</p>
<p>Run the following command until there is a non-empty value in the secret (this can take a minute or two):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl get secret -n services keycloak-certs -o yaml | grep certs.jks
</span></span><span style="display:flex;"><span>  certs.jks: &lt;REDACTED&gt;
</span></span></code></pre></div></li>
<li>
<p>Restart the <code>cray-keycloak-[012]</code> pods.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl rollout restart statefulset -n services cray-keycloak
</span></span></code></pre></div></li>
<li>
<p>Wait for the Keycloak pods to restart before moving on to the next step.</p>
<p>Once the <code>cray-keycloak-[012]</code> pods have restarted, proceed to the next step.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl get po -n services | grep cray-keycloak
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>Re-apply the cray-keycloak-users-localize Helm chart with the updated customizations.yaml file.</p>
<ol>
<li>
<p>Determine the cray-keycloak-users-localize chart version that is currently deployed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# helm ls -A -a | grep cray-keycloak-users-localize | awk <span style="color:#e6db74">&#39;{print $(NF-1)}&#39;</span>
</span></span><span style="display:flex;"><span>cray-keycloak-users-localize-1.5.6
</span></span></code></pre></div></li>
<li>
<p>Create a manifest file that will be used to reapply the same chart version.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cat <span style="color:#e6db74">&lt;&lt; EOF &gt; ./cray-keycloak-users-localize-manifest.yaml
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">apiVersion: manifests/v1beta1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">metadata:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  name: reapply-cray-keycloak-users-localize
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">spec:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  charts:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    - name: cray-keycloak-users-localize
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      namespace: services
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      version: 1.5.6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">EOF</span>
</span></span></code></pre></div></li>
<li>
<p>Uninstall the current cray-keycloak-users-localize chart.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# helm del cray-keycloak-users-localize -n services
</span></span></code></pre></div></li>
<li>
<p>Populate the deployment manifest with data from the customizations.yaml file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# manifestgen -i cray-keycloak-users-localize-manifest.yaml -c customizations.yaml -o deploy.yaml
</span></span></code></pre></div></li>
<li>
<p>Reapply the cray-keycloak-users-localize chart.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# loftsman ship --manifest-path ./deploy.yaml <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--charts-repo https://packages.local/repository/charts
</span></span></code></pre></div></li>
<li>
<p>Watch the pod to check the status of the job.</p>
<p>The pod will go through the normal Kubernetes states. It will stay in a Running state for a while, and then it will go to Completed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl get pods -n services | grep keycloak-users-localize
</span></span><span style="display:flex;"><span>keycloak-users-localize-1-sk2hn                                0/2     Completed   <span style="color:#ae81ff">0</span>          2m35s
</span></span></code></pre></div></li>
<li>
<p>Check the pod&rsquo;s logs.</p>
<p>Replace the <code>KEYCLOAK_POD_NAME</code> value with the pod name from the previous step.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl logs -n services KEYCLOAK_POD_NAME keycloak-localize
</span></span><span style="display:flex;"><span>&lt;logs showing it has updated the <span style="color:#e6db74">&#34;s3&#34;</span> objects and ConfigMaps&gt;
</span></span><span style="display:flex;"><span>2020-07-20 18:26:15,774 - INFO    - keycloak_localize - keycloak-localize complete
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>Sync the users and groups from Keycloak to the compute nodes.</p>
<ol>
<li>
<p>Get the crayvcs password for pushing the changes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# kubectl get secret -n services vcs-user-credentials <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--template<span style="color:#f92672">={{</span>.data.vcs_password<span style="color:#f92672">}}</span> | base64 --decode
</span></span></code></pre></div></li>
<li>
<p>Checkout content from the cos-config-management VCS repository.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git clone https://api-gw-service-nmn.local/vcs/cray/cos-config-management.git
</span></span><span style="display:flex;"><span>ncn-m001# cd cos-config-management
</span></span><span style="display:flex;"><span>ncn-m001# git checkout integration
</span></span></code></pre></div></li>
<li>
<p>Create the group_vars/Compute/keycloak.yaml file.</p>
<p>The file should contain the following values:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>keycloak_config_computes: True
</span></span></code></pre></div></li>
<li>
<p>Push the changes to VCS with the crayvcs username.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# git add group_vars/Compute/keycloak.yaml
</span></span><span style="display:flex;"><span>ncn-m001# git commit -m <span style="color:#e6db74">&#34;Configure keycloak on computes&#34;</span>
</span></span><span style="display:flex;"><span>ncn-m001# git push origin integration
</span></span></code></pre></div></li>
<li>
<p>Update the Configuration Framework Service (CFS) configuration.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray cfs configurations update configurations-example <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>--file ./configurations-example.json --format json
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;lastUpdated&#34;</span>: <span style="color:#e6db74">&#34;2021-07-28T03:26:30:37Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;layers&#34;</span>: <span style="color:#f92672">[</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;cloneUrl&#34;</span>: <span style="color:#e6db74">&#34;https://api-gw-service-nmn.local/vcs/cray/example-repo.git&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;commit&#34;</span>: <span style="color:#e6db74">&#34;&lt;git commit id&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;configurations-layer-example-1&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;playbook&#34;</span>: <span style="color:#e6db74">&#34;site.yml&#34;</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">]</span>,
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;configurations-example&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div></li>
<li>
<p>Reboot with the Boot Orchestration Service (BOS).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ncn-m001# cray bos session create --template-uuid BOS_TEMPLATE --operation reboot
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>Validate that LDAP integration was added successfully.</p>
</li>
</ol>
<pre><code>1. Retrieve the admin password for Keycloak.

   ```bash
   ncn-m001: # kubectl get secrets -n services keycloak-master-admin-auth -ojsonpath='{.data.password}' | base64 -d
   ```

2. Login to the Keycloak UI using the `admin` user and the password obtained in the previous step.
  
   The Keycloak UI URL is typically similar to the following:
  
   ```
   https://auth.&lt;system_name&gt;/keycloak
   ```

3. Click on the &quot;Users&quot; tab in the navigation pane on the left.

4. Click on the &quot;View all users&quot; button and verify the LDAP users appear in the table.

5. Verify a token can be retrieved from Keycloak using an LDAP user/password.

   In the example below, replace myuser, mypass, and shasta in the cURL command with
   site-specific values. The shasta client is created during the SMS install process.

   In the following example, the `python -mjson.tool` is not required; it is simply used to
   format the output for readability.

   ```bash
   ncn-w001# curl -s \
     -d grant_type=password \
     -d client_id=shasta \
     -d username=myuser \
     -d password=mypass \
     https://api-gw-service-nmn.local/keycloak/realms/shasta/protocol/openid-connect/token |
     python -mjson.tool
   ```

   Expected output:

   ```bash
   {
       &quot;access_token&quot;: &quot;ey...IA&quot;, &lt;&lt;-- NOTE this value, used in the following step
       &quot;expires_in&quot;: 300,
       &quot;not-before-policy&quot;: 0,
       &quot;refresh_expires_in&quot;: 1800,
       &quot;refresh_token&quot;: &quot;ey...qg&quot;,
       &quot;scope&quot;: &quot;profile email&quot;,
       &quot;session_state&quot;: &quot;10c7d2f7-8921-4652-ad1e-10138ec6fbc3&quot;,
       &quot;token_type&quot;: &quot;bearer&quot;
   }
   ```

6. Validate that the `access_token` looks correct.

   Copy the `access_token` from the previous step and open a browser window.
   Navigate to http://jwt.io, and paste the token in the &quot;Encoded&quot; field.

   Verify the `preferred_username` is the expected LDAP user and the
   role is `admin` (or other role based on the user).
</code></pre>


<footer class="footline">
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        

        


	 
	 
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs-csm/js/clipboard.min.js?1729741358"></script>
    <script src="/docs-csm/js/perfect-scrollbar.min.js?1729741358"></script>
    <script src="/docs-csm/js/perfect-scrollbar.jquery.min.js?1729741358"></script>
    <script src="/docs-csm/js/jquery.sticky.js?1729741358"></script>
    <script src="/docs-csm/js/featherlight.min.js?1729741358"></script>
    <script src="/docs-csm/js/highlight.pack.js?1729741358"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs-csm/js/modernizr.custom-3.6.0.js?1729741358"></script>
    <script src="/docs-csm/js/learn.js?1729741358"></script>
    <script src="/docs-csm/js/hugo-learn.js?1729741358"></script>
    
        
            <script src="/docs-csm/mermaid/mermaid.js?1729741358"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

