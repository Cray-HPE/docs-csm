<!-- markdownlint-disable MD013 -->
<!-- snmp-authentication-tag -->
<!-- When updating this information, search the docs for the snmp-authentication-tag to find related content -->
<!-- These comments can be removed once we adopt HTTP/lw-dita/Generated docs with re-usable snippets -->
# Configuring SNMP in CSM

This page describes how SNMP is used with CSM and provides some examples of working with SNMP on the management switches.

## How SNMP is Used in CSM
<!-- snmp-authentication-tag -->
<!-- When updating this information, search the docs for the snmp-authentication-tag to find related content -->
<!-- These comments can be removed once we adopt HTTP/lw-dita/Generated docs with re-usable snippets -->

Both the Prometheus SNMP Exporter and REDS hardware discovery use SNMP credentials stored in Vault.  These credentials are read from Vault and pushed into customizations.yaml as a [sealed secret](../../security_and_authentication/Manage_Sealed_Secrets.md).  For the SNMP Exporter and REDS hardware discovery to work, three things need to have been done by an admin.

  1. The SNMP credentials need to have been pushed into the correct path in Vault
      * [Updating the SNMP credentials for existing switches](../../security_and_authentication/Change_Air-Cooled_Node_BMC_Credentials.md)
      * [Updating the SNMP credentials for switches added in the future](../../security_and_authentication/Update_Default_Air-Cooled_BMC_and_Leaf_BMC_Switch_SNMP_Credentials.md)
  1. The SNMP credentials need to have been encrypted as sealed secrets and written to customizations.yaml (this is covered in the docs linked in the previous bullet)
  1. The SNMP credentials need to be added to the running configuration on every management network switch
      * Information about [managing Dell switches](./dell/index.md) including [SNMPv2 community](./dell/snmp-community.md) and [SNMPv3 user](./dell/snmpv3_users.md) settings
      * Information about [managing Mellanox switches](./mellanox/index.md) including [SNMPv2 community](./mellanox/snmp_community.md) and [SNMPv3](./mellanox/snmpv3_users.md) settings
      * Information about [managing Aruba switches](./aruba/index.md) including [SNMPv2 community](./aruba/snmp-community.md) and [SNMPv3](./aruba/snmpv3_users.md) settings

Note that while the [Cray Automated Networking Utility (CANU)](./canu/index.md) will typically not overwrite SNMP settings that are manually applied to the management switches, there are certain cases where SNMP configuration can be over-written or lost (such as when resetting and reconfiguration a switch from factory defaults).  To persist the SNMP settings a [CANU custom configuration](./canu/custom_config.md) should be used.  CANU custom configuration files are used to persist site management network configurations that are intended to take precedence over configurations generated by CANU.

If the Prometheus SNMP Exporter or REDS hardware discovery emit errors related to SNMP authentication, an admin should

* Validate that the correct SNMP credential key/value pairs exist in Vault (see info above)
* [Validate that the SNMP credential sealed secrets in customizations.yaml match Vault](../../security_and_authentication/Manage_Sealed_Secrets.md#fix-an-incorrect-value-in-a-sealed-secret) and the credentials stored on the management switches
* Validate that the SNMP credentials configured on the management switches match the credentials stored in Vault (see info above)

## Examples of Configuring SNMP on Management Switches

 The following are examples only; verify SNMP credentials before applying this configuration.

### Dell SNMP

Find Dell specific documentation in the [Dell Management Docs](./dell/README.md)

```console
conf t
   snmp-server group cray-reds-group 3 noauth read cray-reds-view
   snmp-server user testuser cray-reds-group 3 auth md5 xxxxxxxx priv des xxxxxxx
   snmp-server view cray-reds-view 1.3.6.1.2 included
```

### Aruba SNMP

Find Aruba specific documentation in the [Aruba Management Docs](./aruba/README.md).

```console
conf t
   snmp-server vrf default
   snmpv3 user testuser auth md5 auth-pass plaintext xxxxxx priv des priv-pass plaintext xxxxx
```

### Mellanox SNMP

Note: REDS Hardware Discovery only scans leaf switches and Mellanox switches are only used as spines.  As such, SNMP on the Mellanox switches is only used by the Prometheus SNMP Exporter.

Find Mellanox specific documentation in the [Mellanox Management Docs](./mellanox/README.md)

```console
    snmp-server user testuser v3 capability admin
    snmp-server user testuser v3 enable
    snmp-server user testuser v3 enable sets
    snmp-server user testuser v3 encrypted auth md5 xxxxxxx priv des xxxxxxx
    snmp-server user testuser v3 require-privacy
```
